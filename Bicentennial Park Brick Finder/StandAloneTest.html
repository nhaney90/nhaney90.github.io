<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
    <title>Simple Map</title>
    <link rel="stylesheet" href="https://js.arcgis.com/3.23/esri/css/esri.css">
    <link rel="stylesheet" href="libs/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="libs/autocomplete-combobox/css/bootstrap-combobox.css">
    <style>
      html, body, #map {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script src="https://js.arcgis.com/3.23/"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <script src="libs/bootstrap/js/bootstrap.min.js"></script>
    <script src="libs/autocomplete-combobox/js/bootstrap-combobox.js"></script>
    <script>
      var map;

      require([
        "esri/config",
        "esri/map",
        "esri/urlUtils",

        "esri/arcgis/utils",

        "esri/tasks/query",
        "esri/tasks/QueryTask",

        "dojo/domReady!"
      ], function(esriConfig, Map, urlUtils, arcgisUtils, Query, QueryTask) {

        //esriConfig.defaults.io.proxyUrl = "https://maps.huntsvilleal.gov/proxy/proxy.ashx";
        //esriConfig.defaults.io.alwaysUseProxy = true;

        //arcgisUtils.createMap("59b14c9a88e4440b86711bc63ee73af5", "map").then(function (response) {
          //map = response.map;
        //});

        let uniqueLastNames = [];
        let uniqueOrganizations = [];

        let uniqueFirstNames = null;

        let lastNameQuery = new Query();
        lastNameQuery.outFields = ["LastName"];
        lastNameQuery.orderByFields = ["LastName"];
        lastNameQuery.returnGeometry  = false;
        lastNameQuery.where = '1=1';

        let firstNameQuery = new Query();
        firstNameQuery.outFields = ["FirstName"];
        firstNameQuery.orderByFields = ["FirstName"];
        firstNameQuery.returnGeometry  = false;
        firstNameQuery.where = '1=1';

        let inscriptionQuery = new Query();
        inscriptionQuery.outFields = ["Inscriptio"];
        inscriptionQuery.orderByFields = ["Inscriptio"];
        inscriptionQuery.returnGeometry  = false;
        inscriptionQuery.where = "Inscriptio LIKE '%love%'";

        let brickQueryTask = new QueryTask("https://maps.huntsvilleal.gov/arcgis/rest/services/BicentennialPark/MapServer/13");
        brickQueryTask.execute(lastNameQuery, (results) => {
          let uniqueNames = [...new Set(results.features.map(item => item.attributes.LastName))];
          for(var name in uniqueNames) {
            if(uniqueNames[name].split(' ').length > 1) uniqueOrganizations.push(uniqueNames[name]);
            else uniqueLastNames.push(uniqueNames[name]);
          }
          console.log(uniqueLastNames);
          console.log(uniqueOrganizations);

          populateCombobox("lastNameCombobox", uniqueLastNames);
        });

        brickQueryTask.execute(firstNameQuery, (results) => {
          uniqueFirstNames = [...new Set(results.features.map(item => item.attributes.FirstName))];
          console.log(uniqueFirstNames);
        });

        brickQueryTask.execute(inscriptionQuery, (results) => {
            console.log(results.features);
        });

        function populateCombobox(elementId, valueArray) {
          for(var item in valueArray) {
            let element = "<option value='" + valueArray[item] + "'>" + valueArray[item] + "</option>";
            $("#" + elementId).append(element);
          }
          $("#" + elementId).combobox({
            bsVersion:'4',
          });
        }

      });

    </script>
  </head>

  <body>
    <!--<div id="map"></div>-->
    <h2>Select Last Name</h2>
    <select id="lastNameCombobox" class="input-large form-control"></select>
  </body>
</html>
